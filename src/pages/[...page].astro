---
import type { QuoteFrontmatter } from "$lib/types";

import dayjs from "dayjs";
import calendar from "dayjs/plugin/calendar";
dayjs.extend(calendar);
const calendarDisplayOptions = {
  sameDay: "[Today at] h:mm A", // The same day ( Today at 2:30 AM )
  nextDay: "[Tomorrow at] h:mm A", // The next day ( Tomorrow at 2:30 AM )
  nextWeek: "dddd [at] h:mm A", // The next week ( Sunday at 2:30 AM )
  lastDay: "[Yesterday at] h:mm A", // The day before ( Yesterday at 2:30 AM )
  lastWeek: "[Last] dddd [at] h:mm A", // Last week ( Last Monday at 2:30 AM )
  sameElse: "DD.MM.YYYY", // Everything else ( 17/10/2011 )
};

function formatDate(date: string) {
  return dayjs(date).calendar(null, calendarDisplayOptions);
}

import Base from "$layouts/Base.astro";
import { sortQuotesDescendingByTime } from "$lib/sorting";

export async function getStaticPaths({ paginate }) {
  const quotes = await Astro.glob<QuoteFrontmatter>("../lib/quotes/**/*.md");
  const sortedQuotes = sortQuotesDescendingByTime(quotes);
  return paginate(sortedQuotes, { pageSize: 10 });
}
// All paginated data is passed on the "page" prop
const { page } = Astro.props;
---

<Base title="Quoke â€” a few quotations">
  {
    page.data.map((post) => {
      const { text, dateAdded } = post.frontmatter;

      return (
        <div class="quote">
          <div class="from-now">{formatDate(dateAdded)}</div>
          <div class="text">{text.substring(0, 64)}</div>
        </div>
      );
    })
  }

  {page.url.prev && <a href={page.url.prev}>Previous</a>}
  {page.url.prev && page.url.next && <span> -- </span>}
  {page.url.next && <a href={page.url.next}>Next</a>}
</Base>

<style lang="scss">
  .quote {
    margin-bottom: 3em;
  }

  .from-now {
    font-size: 1em;
    color: #999;
    margin-bottom: 0.5em;
  }

  .text {
    font-size: 2em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .divider {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    opacity: 0.2;
  }

  .author {
    // font-weight: bold;
  }

  .source {
    margin-top: 0.25em;
    opacity: 0.7;
  }
</style>
